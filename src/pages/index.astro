---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// Blog collection is still static at build time
const posts = await getCollection('blog');
const latestPost = posts
  .filter((post) => !post.data.draft)
  .sort((a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate))[0];
const { Content } = await latestPost.render();
---

<BaseLayout title="Home">

  <section style="margin-top: 3rem;">
    <h4>I score AI news daily based on relevance to my research interests. These are today's top stories. Click to open.</h4>

    <!-- Placeholder list for client-side fetch -->
    <ul id="latest-articles" style="list-style: none; padding: 0;"></ul>

    <script>
      // Client-side fetch after page loads
      fetch('/home_articles')
        .then((res) => res.json())
        .then((articles) => {
          const list = document.getElementById('latest-articles');
          list.innerHTML = ''; // clear if needed
          articles.forEach((a) => {
            const li = document.createElement('li');
            li.className = 'article-item';
            li.innerHTML = `<a href="${a.url}" target="_blank" class="article-title">${a.title}</a>`;
            list.appendChild(li);
          });
        })
        .catch((err) => {
          console.error('Error loading articles:', err);
        });
    </script>
  </section>

  <hr style="margin: 2rem 0;" />

  <section>
    <h3>{latestPost.data.title}</h3>
    <p><em>{latestPost.data.pubDate.toDateString()}</em></p>

    <article class="blog-body">
      <Content />
    </article>
    <h3>
      <a href="/blog" class="external-link">All blog posts</a>
    </h3>
  </section>

</BaseLayout>
